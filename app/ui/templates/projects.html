{% extends "table_base.html" %}

{% block content %}
<h2>Project List</h2>
<button type="button" class="btn btn-primary" id="openProjectModal">
    Create New Project
</button>
<div class="table-responsive">
    <table id="data" class="table table-light table-striped table-hover w-100">
        <thead>
        <tr>
            <th>Project Number</th>
            <th>Client Name</th>
            <th>Project Address</th>
            <th>Status</th>
            <th>Description</th>
            <th>Initial Inquiry</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Storeys</th>
            <th>Referral Source</th>
            <th>Payment Basis</th>
            <th>Creation Date</th>
        </tr>
        </thead>
        <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.number }}</td>
            <td>{{ project.client_name }}</td>
            <td>{{ project.full_address }}</td>
            <td>{{ project.status }}</td>
            <td>{{ project.description or 'N/A' }}</td>
            <td>{{ project.initial_inquiry_date }}</td>
            <td>{{ project.start_date or 'N/A' }}</td>
            <td>{{ project.end_date or 'N/A' }}</td>
            <td>{{ project.storeys or 'N/A' }}</td>
            <td>{{ project.referral_source or 'N/A' }}</td>
            <td>{{ project.payment_basis or 'N/A' }}</td>
            <td>{{ project.creation_datetime }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
{% block table_scripts %}
<script>
    $(document).ready(function () {
        let projectsTable = $('#data').DataTable({
            processing: true,
            serverSide: false,
            autoWidth: true,
            ajax: {
                url: "http://localhost:8080/projects",
                type: "GET",
                dataSrc: ""
            },
            pageLength: 10,     // Show 10 entries per page
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]], // Pagination options
            columns: [
                {data: "number"},
                {data: "client_name"},
                {data: "full_address"},
                {data: "status"},
                {data: "description"},
                {data: "initial_inquiry_date"},
                {data: "start_date"},
                {data: "end_date"},
                {data: "storeys"},
                {data: "referral_source"},
                {data: "payment_basis"},
                {
                    data: "creation_datetime",
                    render: function (data) {
                        return data ? new Date(data).toLocaleString() : 'N/A';
                    }
                }
            ]
        });
    });
</script>
{% endblock %}
