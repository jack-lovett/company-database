{% extends "table_base.html" %}

{% block content %}
<h2>Contact List</h2>
<button type="button" class="btn btn-primary" id="openContactModal">
    Create Contact
</button>
<div class="table-responsive">
    <table id="data" class="table table-light table-striped table-hover w-100 datatable-hidden">
        <thead>
        <tr>
            <th>Contact ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Business Name</th>
            <th>ABN</th>
            <th>Billing Address</th>
            <th>Postal Address</th>
            <th>Creation Date</th>
        </tr>
        </thead>
        <tbody>
        {% for contact in contacts %}
        <tr>
            <td>{{ contact.id }}</td>
            <td>{{ contact.first_name }}</td>
            <td>{{ contact.last_name }}</td>
            <td>{{ contact.phone or 'N/A' }}</td>
            <td>{{ contact.email or 'N/A' }}</td>
            <td>{{ contact.business_name or 'N/A' }}</td>
            <td>{{ contact.abn or 'N/A' }}</td>
            <td>{{ contact.billing_address }}</td>
            <td>{{ contact.postal_address }}</td>
            <td>{{ contact.creation_datetime }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% include "components/loading_spinner.html" %}

{% endblock %}
{% block table_scripts %}
<script>
    $(document).ready(function () {
        let contactsTable = $('#data').DataTable({
            processing: true,
            serverSide: false,
            autoWidth: true,
            ajax: {
                url: "http://localhost:8080/contacts",
                type: "GET",
                dataSrc: ""
            },
            pageLength: 10,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
            columns: [
                {data: "id"},
                {data: "first_name"},
                {data: "last_name"},
                {data: "phone"},
                {data: "email"},
                {data: "business_name"},
                {data: "abn"},
                {data: "billing_address"},
                {data: "postal_address"},
                {
                    data: "creation_datetime",
                    render: function (data) {
                        return data ? new Date(data).toLocaleString() : 'N/A';
                    }
                }
            ],
            initComplete: function () {
                $('#loading-spinner').hide();
                $('#data').removeClass('datatable-hidden');
            }
        });
    });
</script>
{% endblock %}
